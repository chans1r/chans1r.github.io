<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†æ•¸å€’æ•¸æŒ‘æˆ°è³½</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4a90e2;
            --success: #2ecc71;
            --error: #e74c3c;
            --bg: #f4f7f9;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden; /* é˜²æ­¢æ»¾å‹•å½±éŸ¿é«”é©— */
        }

        #app {
            width: 90%;
            max-width: 600px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .screen { display: none; }
        .screen.active { display: block; }

        /* éŠæˆ²è³‡è¨Š */
        .game-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: bold;
            color: #555;
            padding: 0 10px;
        }

        /* æ ¸å¿ƒå¡ç‰‡ç¶²æ ¼ */
        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr); /* é è¨­ 2 æ¬„ï¼Œé©åˆæ‰‹æ©Ÿ */
            gap: 12px;
            justify-content: center;
        }

        @media (min-width: 480px) {
            .grid {
                grid-template-columns: repeat(5, 1fr); /* é›»è…¦ç«¯ 5 æ¬„ 2 åˆ— */
            }
        }

        .card {
            aspect-ratio: 1/1;
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .card.selected { border-color: var(--primary); background: #f0f7ff; transform: scale(1.05); }
        .card.correct { background: var(--success); border-color: var(--success); color: white; animation: pop 0.4s; }
        .card.wrong { background: var(--error); border-color: var(--error); color: white; animation: shake 0.4s; }
        .card.matched { visibility: hidden; opacity: 0; pointer-events: none; }

        /* åˆ†æ•¸æ¨£å¼ */
        .frac-box { display: flex; align-items: center; font-weight: bold; color: inherit; }
        .whole { font-size: 1.3em; margin-right: 3px; }
        .frac { display: flex; flex-direction: column; align-items: center; line-height: 1; font-size: 0.9em; }
        .num { border-bottom: 2px solid currentColor; padding: 0 4px; }
        .den { padding: 0 4px; }

        /* æŒ‰éˆ•èˆ‡æ–‡å­— */
        h1 { color: var(--primary); margin-bottom: 10px; }
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 40px;
            font-size: 1.2em;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(74, 144, 226, 0.3);
        }
        .btn:hover { background: #357abd; }

        /* å‹•ç•« */
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-8px); } 75% { transform: translateX(8px); } }
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.15); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div id="app">
    <!-- å°é¢é  -->
    <div id="screen-start" class="screen active">
        <h1>å…©æ•¸ç›¸ä¹˜ = 1</h1>
        <p style="color: #666; margin-bottom: 30px;">æ‰¾å‡ºäº’ç‚ºã€Œå€’æ•¸ã€çš„å…©å¼µå¡ç‰‡<br>çœ‹èª°èƒ½ä»¥æœ€å¿«é€Ÿåº¦å®Œæˆ 5 çµ„é…å°ï¼</p>
        <button class="btn" onclick="startGame()">é€²å…¥éŠæˆ²</button>
    </div>

    <!-- éŠæˆ²é  -->
    <div id="screen-game" class="screen">
        <div class="game-header">
            <div>å®Œæˆ: <span id="match-count">0</span> / 5</div>
            <div style="color: var(--primary);">æ™‚é–“: <span id="timer">0.0</span>s</div>
        </div>
        <div id="grid" class="grid"></div>
    </div>

    <!-- çµæŸé  -->
    <div id="screen-end" class="screen">
        <h1 style="color: var(--success);">ğŸ‰ æŒ‘æˆ°æˆåŠŸï¼</h1>
        <p>ä½ çš„å®Œæˆæ™‚é–“ï¼š</p>
        <div style="font-size: 3em; font-weight: bold; margin: 20px 0;" id="final-time">0s</div>
        <button class="btn" onclick="startGame()">å†ç©ä¸€æ¬¡</button>
    </div>
</div>

<script>
    let selected = [];
    let matches = 0;
    let timerId = null;
    let startTime = 0;
    let isWaiting = false;

    // æœ€å¤§å…¬ç´„æ•¸ (ç”¨æ–¼åŒ–ç°¡åˆ†æ•¸)
    const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);

    // æ ¼å¼åŒ–åˆ†æ•¸ HTML
    function getFracHTML(n, d) {
        // éš¨æ©Ÿè½‰æ›å‡åˆ†æ•¸ç‚ºå¸¶åˆ†æ•¸
        if (n > d && Math.random() > 0.4) {
            const w = Math.floor(n / d);
            const r = n % d;
            if (r === 0) return `<div class="frac-box"><span class="whole">${w}</span></div>`;
            return `<div class="frac-box"><span class="whole">${w}</span><div class="frac"><span class="num">${r}</span><span class="den">${d}</span></div></div>`;
        }
        return `<div class="frac-box"><div class="frac"><span class="num">${n}</span><span class="den">${d}</span></div></div>`;
    }

    // ç”Ÿæˆéš¨æ©Ÿé¡Œç›®
    function generateCards() {
        const pairs = [];
        const used = new Set();

        while (pairs.length < 10) {
            let n = Math.floor(Math.random() * 9) + 2;
            let d = Math.floor(Math.random() * 9) + 2;
            if (n === d) continue;

            const common = gcd(n, d);
            n /= common;
            d /= common;

            const key = `${n}/${d}`;
            if (used.has(key) || used.has(`${d}/${n}`)) continue;
            used.add(key);

            // åŠ å…¥ä¸€å°å€’æ•¸
            pairs.push({ val: n/d, html: getFracHTML(n, d) });
            pairs.push({ val: d/n, html: getFracHTML(d, n) });
        }
        return pairs.sort(() => Math.random() - 0.5);
    }

    function startGame() {
        // åˆ‡æ›ç•«é¢èˆ‡é‡ç½®
        matches = 0;
        selected = [];
        isWaiting = false;
        document.getElementById('match-count').innerText = "0";
        switchScreen('screen-game');

        const cardData = generateCards();
        const grid = document.getElementById('grid');
        grid.innerHTML = '';

        cardData.forEach(data => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = data.html;
            card.onclick = () => handleCardClick(card, data);
            grid.appendChild(card);
        });

        // è¨ˆæ™‚å™¨
        startTime = Date.now();
        clearInterval(timerId);
        timerId = setInterval(() => {
            const time = ((Date.now() - startTime) / 1000).toFixed(1);
            document.getElementById('timer').innerText = time;
        }, 100);
    }

    function handleCardClick(el, data) {
        // é˜²æ­¢é‡è¤‡é»æ“ŠåŒä¸€å¼µæˆ–åœ¨å‹•ç•«ä¸­é»æ“Š
        if (isWaiting || el.classList.contains('selected') || el.classList.contains('matched')) return;

        el.classList.add('selected');
        selected.push({ el, data });

        if (selected.length === 2) {
            isWaiting = true;
            check();
        }
    }

    function check() {
        const [c1, c2] = selected;
        // åˆ¤æ–·ç›¸ä¹˜æ˜¯å¦ç‚º 1 (è€ƒæ…®æµ®é»æ•¸èª¤å·®)
        const success = Math.abs((c1.data.val * c2.data.val) - 1) < 0.0001;

        if (success) {
            c1.el.classList.add('correct');
            c2.el.classList.add('correct');
            
            setTimeout(() => {
                c1.el.classList.replace('correct', 'matched');
                c2.el.classList.replace('correct', 'matched');
                matches++;
                document.getElementById('match-count').innerText = matches;
                selected = [];
                isWaiting = false; // é–‹æ”¾ä¸‹æ¬¡é»æ“Š
                if (matches === 5) endGame();
            }, 500);
        } else {
            c1.el.classList.add('wrong');
            c2.el.classList.add('wrong');
            
            setTimeout(() => {
                c1.el.classList.remove('wrong', 'selected');
                c2.el.classList.remove('wrong', 'selected');
                selected = [];
                isWaiting = false; // é–‹æ”¾ä¸‹æ¬¡é»æ“Š
            }, 600);
        }
    }

    function endGame() {
        clearInterval(timerId);
        document.getElementById('final-time').innerText = document.getElementById('timer').innerText + 's';
        setTimeout(() => switchScreen('screen-end'), 400);
    }

    function switchScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
</script>

</body>
</html>
